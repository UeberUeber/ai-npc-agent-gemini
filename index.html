<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI NPC ëŒ€í™” ì‹œìŠ¤í…œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #e0e0e0;
    }

    .container {
      display: flex;
      height: 100vh;
      padding: 20px;
      gap: 20px;
    }

    /* 3ì—´ ë ˆì´ì•„ì›ƒ */
    .panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .panel-header {
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.08);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .panel-header h2 {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #4ade80;
    }

    .status-dot.offline {
      background: #6b7280;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    /* ì™¼ìª½ íŒ¨ë„ - ê²Œì„ ì›”ë“œ */
    .left-panel {
      background: rgba(34, 197, 94, 0.05);
      border-color: rgba(34, 197, 94, 0.2);
    }

    .left-panel .panel-header {
      background: rgba(34, 197, 94, 0.1);
    }

    .left-panel .panel-content {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .game-world {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      flex: 1;
      gap: 12px;
      padding: 4px 0;
      min-height: 0;
    }

    .game-time {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      font-size: 1.1rem;
      color: #fcd34d;
      font-weight: 600;
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .game-time .day {
      color: #9ca3af;
      font-size: 0.85rem;
      font-weight: normal;
    }

    .game-time .period {
      padding: 2px 8px;
      background: rgba(245, 158, 11, 0.2);
      border-radius: 6px;
      font-size: 0.8rem;
      color: #f59e0b;
    }

    /* ===== íƒ€ì¼ ì‹œìŠ¤í…œ ===== */
    .game-grid {
      display: grid;
      grid-template-columns: repeat(15, 1fr);
      grid-template-rows: repeat(15, 1fr);
      gap: 2px;
      background: #1a1a2e;
      padding: 6px;
      border-radius: 8px;
      aspect-ratio: 1;
      /* ë†’ì´ ê¸°ì¤€ìœ¼ë¡œ ì •ì‚¬ê°í˜• í¬ê¸° ê³„ì‚° (ë·°í¬íŠ¸ ë†’ì´ - í—¤ë”/í‘¸í„° ì—¬ë°±) */
      height: calc(100vh - 320px);
      width: auto;
      max-width: 100%;
    }

    /* ê¸°ë³¸ íƒ€ì¼ - ì”ë”” */
    .game-tile {
      position: relative;
      aspect-ratio: 1;
      background: #2d5a27;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      cursor: pointer;
      user-select: none;
    }

    .game-tile:hover {
      filter: brightness(1.2);
    }

    /* ë²½/ê±´ë¬¼ íƒ€ì¼ */
    .game-tile.blocked {
      background: #4a4a5a;
      cursor: not-allowed;
    }

    /* í”Œë ˆì´ì–´ íƒ€ì¼ */
    .game-tile.player {
      background: #3b82f6;
      box-shadow: 0 0 6px #3b82f6;
    }

    /* í”Œë ˆì´ì–´ ë°©í–¥ í™”ì‚´í‘œ */
    .player-direction {
      position: absolute;
      font-size: 0.5rem;
      color: #fff;
      text-shadow: 0 0 2px #000;
      z-index: 2;
    }

    .game-tile.player.facing-up .player-direction {
      top: -2px;
      left: 50%;
      transform: translateX(-50%);
    }

    .game-tile.player.facing-down .player-direction {
      bottom: -2px;
      left: 50%;
      transform: translateX(-50%);
    }

    .game-tile.player.facing-left .player-direction {
      left: -2px;
      top: 50%;
      transform: translateY(-50%);
    }

    .game-tile.player.facing-right .player-direction {
      right: -2px;
      top: 50%;
      transform: translateY(-50%);
    }

    /* NPC íƒ€ì¼ */
    .game-tile.npc {
      background: #f59e0b;
    }

    .game-tile.npc.nearby {
      box-shadow: 0 0 8px #f59e0b;
      animation: npc-pulse 1s infinite;
    }

    /* NPC ë°©í–¥ í™”ì‚´í‘œ */
    .npc-direction {
      position: absolute;
      font-size: 0.5rem;
      color: #fff;
      text-shadow: 0 0 2px #000;
      z-index: 2;
    }

    .game-tile.npc.facing-up .npc-direction {
      top: -2px;
      left: 50%;
      transform: translateX(-50%);
    }

    .game-tile.npc.facing-down .npc-direction {
      bottom: -2px;
      left: 50%;
      transform: translateX(-50%);
    }

    .game-tile.npc.facing-left .npc-direction {
      left: -2px;
      top: 50%;
      transform: translateY(-50%);
    }

    .game-tile.npc.facing-right .npc-direction {
      right: -2px;
      top: 50%;
      transform: translateY(-50%);
    }

    /* ì˜¤ë¸Œì íŠ¸ íƒ€ì¼ */
    .game-tile.object {
      background: #8b5cf6;
    }

    /* NPC ì‹œì•¼ ì˜ì—­ (ì˜¤ë²„ë ˆì´) */
    .game-tile.npc-vision {
      box-shadow: inset 0 0 0 2px rgba(251, 191, 36, 0.6);
    }

    @keyframes npc-pulse {
      0%, 100% { box-shadow: 0 0 6px #f59e0b; }
      50% { box-shadow: 0 0 12px #f59e0b; }
    }

    /* ë²”ë¡€ - panel-content í•˜ë‹¨ ê³ ì • */
    .game-legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 4px 10px;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 6px;
      font-size: 0.7rem;
      color: #d1d5db;
      margin-top: auto;
      flex-shrink: 0;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .legend-color {
      width: 10px;
      height: 10px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    .game-status {
      padding: 8px 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-size: 0.85rem;
      text-align: center;
    }

    .game-status.can-talk {
      background: rgba(245, 158, 11, 0.2);
      color: #fcd34d;
    }

    /* ê°€ìš´ë° íŒ¨ë„ - í”Œë ˆì´ì–´ ì…ë ¥ */
    .center-panel {
      flex: 0.8;
      background: rgba(59, 130, 246, 0.05);
      border-color: rgba(59, 130, 246, 0.2);
    }

    .center-panel .panel-header {
      background: rgba(59, 130, 246, 0.1);
    }

    .chat-messages {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .message {
      display: flex;
      gap: 12px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .message.user .message-avatar {
      background: rgba(59, 130, 246, 0.3);
    }

    .message.npc .message-avatar {
      background: rgba(245, 158, 11, 0.3);
    }

    .message-content {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 16px;
      line-height: 1.5;
    }

    .message.user .message-content {
      background: rgba(59, 130, 246, 0.2);
      border-bottom-right-radius: 4px;
    }

    .message.npc .message-content {
      background: rgba(245, 158, 11, 0.15);
      border-bottom-left-radius: 4px;
    }

    .message-sender {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .input-area {
      padding: 16px 20px;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .input-wrapper {
      display: flex;
      gap: 12px;
    }

    .input-wrapper input {
      flex: 1;
      padding: 14px 18px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      color: #e0e0e0;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .input-wrapper input:focus {
      border-color: rgba(59, 130, 246, 0.5);
    }

    .input-wrapper input::placeholder {
      color: #6b7280;
    }

    .input-wrapper button {
      padding: 14px 24px;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.2s;
    }

    .input-wrapper button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .input-wrapper button:active {
      transform: translateY(0);
    }

    .input-wrapper button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ì˜¤ë¥¸ìª½ íŒ¨ë„ - ëŒ€ì¥ì¥ì´ ì¡´ */
    .right-panel {
      background: rgba(245, 158, 11, 0.05);
      border-color: rgba(245, 158, 11, 0.2);
    }

    .right-panel .panel-header {
      background: rgba(245, 158, 11, 0.1);
    }

    .npc-info {
      margin-bottom: 20px;
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }

    .npc-info h3 {
      font-size: 1rem;
      margin-bottom: 12px;
      color: #f59e0b;
    }

    .npc-stat {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.9rem;
      gap: 12px;
    }

    .npc-stat:last-child {
      border-bottom: none;
    }

    .npc-stat .label {
      color: #9ca3af;
      flex-shrink: 0;
      min-width: 40px;
    }

    .npc-stat .value {
      color: #e0e0e0;
      text-align: right;
      word-break: keep-all;
      overflow-wrap: break-word;
    }

    .memory-section h3 {
      font-size: 1rem;
      margin-bottom: 12px;
      color: #f59e0b;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .clear-btn {
      margin-left: auto;
      padding: 4px 8px;
      font-size: 0.7rem;
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      color: #ef4444;
      cursor: pointer;
      transition: background 0.2s;
    }

    .clear-btn:hover {
      background: rgba(239, 68, 68, 0.3);
    }

    .memory-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .memory-item {
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .memory-item .type {
      font-size: 0.7rem;
      color: #f59e0b;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .memory-item .importance {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 4px;
    }

    .empty-state {
      color: #6b7280;
      font-size: 0.9rem;
      text-align: center;
      padding: 20px;
    }

    /* ë¡œë”© ì¸ë””ì¼€ì´í„° */
    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 12px 16px;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: #f59e0b;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }

    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    /* API í‚¤ ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: #1e293b;
      padding: 32px;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      text-align: center;
    }

    .modal-content h2 {
      margin-bottom: 8px;
      color: #f59e0b;
    }

    .modal-content p {
      margin-bottom: 24px;
      color: #9ca3af;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .modal-content input {
      width: 100%;
      padding: 14px 18px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      color: #e0e0e0;
      font-size: 1rem;
      margin-bottom: 16px;
      outline: none;
    }

    .modal-content input:focus {
      border-color: rgba(245, 158, 11, 0.5);
    }

    .modal-content button {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(135deg, #f59e0b, #d97706);
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
    }

    .modal-content button:hover {
      opacity: 0.9;
    }

    .modal-content a {
      display: block;
      margin-top: 16px;
      color: #60a5fa;
      font-size: 0.85rem;
      text-decoration: none;
    }

    .modal-content a:hover {
      text-decoration: underline;
    }

    .message.system .message-avatar {
      background: rgba(107, 114, 128, 0.3);
    }

    .message.system .message-content {
      background: rgba(107, 114, 128, 0.2);
    }

    /* ì‹œìŠ¤í…œ ë¡œê·¸ */
    .log-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 150px;
      overflow-y: auto;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.75rem;
    }

    .log-item {
      padding: 6px 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      border-left: 3px solid #6b7280;
      line-height: 1.3;
    }

    .log-item.info {
      border-left-color: #3b82f6;
      color: #93c5fd;
    }

    .log-item.success {
      border-left-color: #22c55e;
      color: #86efac;
    }

    .log-item.warning {
      border-left-color: #f59e0b;
      color: #fcd34d;
    }

    .log-item .timestamp {
      color: #6b7280;
      margin-right: 8px;
    }

    /* Reflection íƒ€ì… ë©”ëª¨ë¦¬ ê°•ì¡° */
    .memory-item.reflection {
      background: rgba(139, 92, 246, 0.2);
      border-left: 3px solid #8b5cf6;
    }

    .memory-item.reflection .type {
      color: #a78bfa;
    }

    /* ì¤‘ìš”ë„ íˆ´íŒ */
    .importance {
      position: relative;
      cursor: help;
    }

    .importance.pending {
      color: #9ca3af;
      font-style: italic;
    }

    .importance.evaluated {
      color: #4ade80;
    }

    .importance-tooltip {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      width: 320px;
      padding: 16px;
      background: #1e293b;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      z-index: 100;
      transition: opacity 0.2s, visibility 0.2s;
      text-align: left;
      font-style: normal;
      line-height: 1.5;
    }

    .importance-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 8px solid transparent;
      border-top-color: #1e293b;
    }

    .importance:hover .importance-tooltip {
      visibility: visible;
      opacity: 1;
    }

    .importance-tooltip h4 {
      color: #f59e0b;
      font-size: 0.9rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .importance-tooltip p {
      color: #d1d5db;
      font-size: 0.8rem;
      margin-bottom: 12px;
    }

    .importance-tooltip .section {
      margin-bottom: 12px;
    }

    .importance-tooltip .section-title {
      color: #60a5fa;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .importance-tooltip .section-content {
      color: #9ca3af;
      font-size: 0.78rem;
    }

    .importance-tooltip code {
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.75rem;
      color: #fcd34d;
    }

    .importance-tooltip .scale {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
    }

    .importance-tooltip .scale-item {
      text-align: center;
      font-size: 0.7rem;
    }

    .importance-tooltip .scale-item .num {
      font-weight: bold;
      color: #f59e0b;
    }

    /* ì •ë³´ ì•„ì´ì½˜ íˆ´íŒ (Planning ë“±) */
    .info-icon {
      position: relative;
      cursor: help;
      font-size: 0.85rem;
      margin-left: 4px;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .info-icon:hover {
      opacity: 1;
    }

    .info-tooltip {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      bottom: calc(100% + 12px);
      left: 50%;
      transform: translateX(-50%);
      width: 360px;
      padding: 16px;
      background: #1e293b;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      z-index: 9999;
      transition: opacity 0.2s, visibility 0.2s;
      text-align: left;
      font-style: normal;
      font-weight: normal;
      line-height: 1.5;
    }

    .info-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 8px solid transparent;
      border-top-color: #1e293b;
    }

    .info-icon:hover .info-tooltip {
      visibility: visible;
      opacity: 1;
    }

    .info-tooltip h4 {
      color: #60a5fa;
      font-size: 0.9rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .info-tooltip p {
      color: #d1d5db;
      font-size: 0.8rem;
      margin-bottom: 12px;
    }

    .info-tooltip .section {
      margin-bottom: 12px;
    }

    .info-tooltip .section-title {
      color: #f59e0b;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-tooltip .section-content {
      color: #9ca3af;
      font-size: 0.78rem;
    }

    .info-tooltip .input-item {
      margin: 4px 0;
      padding-left: 8px;
      border-left: 2px solid rgba(96, 165, 250, 0.3);
    }

    .info-tooltip code {
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.75rem;
      color: #fcd34d;
    }

    /* íŒ¨ë„ ë¦¬ì‚¬ì´ì € */
    .resizer {
      width: 8px;
      background: transparent;
      cursor: col-resize;
      position: relative;
      flex-shrink: 0;
      margin: 0 -4px;
      z-index: 10;
      transition: background 0.2s;
    }

    .resizer::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 4px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      transition: background 0.2s, height 0.2s;
    }

    .resizer:hover::before,
    .resizer.dragging::before {
      background: rgba(59, 130, 246, 0.6);
      height: 60px;
    }

    .resizer.dragging {
      background: rgba(59, 130, 246, 0.1);
    }

    /* ë¦¬ì‚¬ì´ì¦ˆ ì¤‘ ì„ íƒ ë°©ì§€ */
    body.resizing {
      cursor: col-resize;
      user-select: none;
    }

    body.resizing * {
      cursor: col-resize !important;
    }

    /* íŒ¨ë„ ìµœì†Œ ë„ˆë¹„ */
    .panel {
      min-width: 200px;
    }

    /* ê³„íš íŒ¨ë„ */
    .plan-section {
      display: flex;
      flex-direction: column;
      max-height: 280px;
      overflow: hidden;
    }

    .plan-section h3 {
      flex-shrink: 0;
      position: sticky;
      top: 0;
      background: #1e293b;
      padding-bottom: 8px;
      margin-bottom: 8px;
      z-index: 1;
    }

    .plan-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow-y: auto;
      flex-grow: 1;
    }

    .plan-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      font-size: 0.8rem;
      transition: background 0.2s, transform 0.2s;
    }

    .plan-item.completed {
      opacity: 0.6;
      text-decoration: line-through;
    }

    .plan-item.completed .plan-status {
      color: #22c55e;
    }

    .plan-item.in_progress {
      background: rgba(245, 158, 11, 0.2);
      border-left: 3px solid #f59e0b;
      transform: scale(1.02);
    }

    .plan-item.in_progress .plan-status {
      color: #fbbf24;
      animation: pulse-icon 1.5s infinite;
    }

    @keyframes pulse-icon {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .plan-item.pending {
      opacity: 0.7;
    }

    /* ëª©í‘œ ê´€ë ¨ í™œë™ ê°•ì¡° */
    .plan-item.goal-related {
      border-right: 3px solid #8b5cf6;
    }

    .plan-item.goal-related .plan-activity {
      color: #c4b5fd;
    }

    .plan-item.pending .plan-status {
      color: #6b7280;
    }

    .plan-item.skipped {
      opacity: 0.4;
      text-decoration: line-through;
    }

    .plan-item.skipped .plan-status {
      color: #ef4444;
    }

    .plan-status {
      font-size: 1rem;
      flex-shrink: 0;
      width: 20px;
      text-align: center;
    }

    .plan-time {
      color: #9ca3af;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.75rem;
      flex-shrink: 0;
      min-width: 42px;
    }

    .plan-activity {
      flex: 1;
      color: #e0e0e0;
    }

    .plan-item.in_progress .plan-activity {
      color: #fcd34d;
      font-weight: 500;
    }

    .plan-location {
      color: #6b7280;
      font-size: 0.7rem;
      flex-shrink: 0;
    }

    .plan-empty {
      color: #6b7280;
      font-size: 0.85rem;
      text-align: center;
      padding: 16px;
    }

    /* ì¸ë¬¼ íƒ­ ìŠ¤íƒ€ì¼ */
    .character-tabs {
      display: flex;
      gap: 4px;
      padding: 0 20px 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 12px;
    }

    .character-tab {
      flex: 1;
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #9ca3af;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .character-tab:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #e0e0e0;
    }

    .character-tab.active {
      background: rgba(245, 158, 11, 0.2);
      border-color: rgba(245, 158, 11, 0.4);
      color: #fcd34d;
    }

    .character-tab.active.player-tab {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.4);
      color: #93c5fd;
    }

    .character-tab .tab-icon {
      margin-right: 6px;
    }

    .character-content {
      display: none;
    }

    .character-content.active {
      display: block;
    }

    /* í”Œë ˆì´ì–´ ì •ë³´ ìŠ¤íƒ€ì¼ */
    .player-info {
      margin-bottom: 20px;
      padding: 16px;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(59, 130, 246, 0.2);
    }

    .player-info h3 {
      font-size: 1rem;
      margin-bottom: 12px;
      color: #60a5fa;
    }

    /* íƒ€ì¼ ì •ë³´ íŒ¨ë„ */
    .tile-info {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 0.8rem;
      border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .tile-info-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .tile-info-header .coords {
      font-family: 'Monaco', 'Consolas', monospace;
      color: #a78bfa;
      font-weight: 600;
    }

    .tile-info-header .tile-type {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 500;
    }

    .tile-type.empty { background: rgba(45, 90, 39, 0.5); color: #86efac; }
    .tile-type.blocked { background: rgba(74, 74, 90, 0.5); color: #d1d5db; }
    .tile-type.player { background: rgba(59, 130, 246, 0.3); color: #93c5fd; }
    .tile-type.npc { background: rgba(245, 158, 11, 0.3); color: #fcd34d; }
    .tile-type.object { background: rgba(139, 92, 246, 0.3); color: #c4b5fd; }

    .tile-info-body {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tile-info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .tile-info-row .label { color: #9ca3af; }
    .tile-info-row .value { color: #e5e7eb; }
    .tile-info-row .value.yes { color: #34d399; }
    .tile-info-row .value.no { color: #6b7280; }

    .tile-info-detail {
      margin-top: 6px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
    }

    .tile-info-detail .name {
      font-weight: 600;
      color: #f3f4f6;
      margin-bottom: 4px;
    }

    .tile-info-detail .desc {
      color: #9ca3af;
      font-size: 0.75rem;
    }

    .tile-info-empty {
      color: #6b7280;
      text-align: center;
      padding: 8px;
      font-size: 0.75rem;
    }
  </style>
</head>
<body>
  <!-- API í‚¤ ì…ë ¥ ëª¨ë‹¬ -->
  <div class="modal" id="apiKeyModal">
    <div class="modal-content">
      <h2>Gemini API í‚¤ ì…ë ¥</h2>
      <p>ëŒ€í™”ë¥¼ ì‹œì‘í•˜ë ¤ë©´ Google Gemini API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      <input type="password" id="apiKeyInput" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
      <button id="apiKeySubmit">ì‹œì‘í•˜ê¸°</button>
      <a href="https://aistudio.google.com/apikey" target="_blank">API í‚¤ ë°œê¸‰ë°›ê¸° (Google AI Studio)</a>
    </div>
  </div>
  <div class="container">
    <!-- ì™¼ìª½: ê²Œì„ ì›”ë“œ -->
    <div class="panel left-panel" id="leftPanel">
      <div class="panel-header">
        <div class="status-dot"></div>
        <h2>ì§€ë„(ë§ˆì„)</h2>
      </div>
      <div class="panel-content">
        <div class="game-world">
          <div class="game-time" id="gameTime">
            <span class="day" id="gameDay">1ì¼ì°¨</span>
            <span class="time" id="gameTimeDisplay">6:00 AM</span>
            <span class="period" id="gamePeriod">ìƒˆë²½</span>
          </div>
          <div class="game-grid" id="gameGrid">
            <!-- 10x10 ê·¸ë¦¬ë“œê°€ JSë¡œ ìƒì„±ë¨ -->
          </div>
        </div>
        <!-- ì»¨íŠ¸ë¡¤: game-world ë°– -->
        <div class="game-status" id="gameStatus">
          ì´ë™: WASD ë˜ëŠ” ë°©í–¥í‚¤ / í´ë¦­
        </div>
        <!-- ë²”ë¡€: game-world ë°– -->
        <div class="game-legend">
          <div class="legend-item"><span class="legend-color" style="background:#3b82f6"></span>í”Œë ˆì´ì–´</div>
          <div class="legend-item"><span class="legend-color" style="background:#f59e0b"></span>NPC</div>
          <div class="legend-item"><span class="legend-color" style="background:#8b5cf6"></span>ì˜¤ë¸Œì íŠ¸</div>
          <div class="legend-item"><span class="legend-color" style="background:#4a4a5a"></span>ë²½</div>
          <div class="legend-item"><span class="legend-color" style="border:2px solid #fbbf24;background:transparent"></span>ì‹œì•¼</div>
        </div>
        <!-- íƒ€ì¼ ì •ë³´ íŒ¨ë„ -->
        <div class="tile-info" id="tileInfo">
          <div class="tile-info-empty">íƒ€ì¼ì„ í´ë¦­í•˜ë©´ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>
      </div>
    </div>

    <!-- ë¦¬ì‚¬ì´ì € 1: ì™¼ìª½-ê°€ìš´ë° -->
    <div class="resizer" id="resizer1"></div>

    <!-- ê°€ìš´ë°: í”Œë ˆì´ì–´ ëŒ€í™” -->
    <div class="panel center-panel" id="centerPanel">
      <div class="panel-header">
        <div class="status-dot"></div>
        <h2>ëŒ€í™”</h2>
      </div>
      <div class="panel-content">
        <div class="chat-messages" id="chatMessages">
          <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
        </div>
      </div>
      <div class="input-area">
        <div class="input-wrapper">
          <input
            type="text"
            id="userInput"
            placeholder="ëŒ€ì¥ì¥ì´ ì¡´ì—ê²Œ ë§í•˜ê¸°..."
            autocomplete="off"
          />
          <button id="sendButton">ì „ì†¡</button>
        </div>
      </div>
    </div>

    <!-- ë¦¬ì‚¬ì´ì € 2: ê°€ìš´ë°-ì˜¤ë¥¸ìª½ -->
    <div class="resizer" id="resizer2"></div>

    <!-- ì˜¤ë¥¸ìª½: ì¸ë¬¼ -->
    <div class="panel right-panel" id="rightPanel">
      <div class="panel-header">
        <div class="status-dot"></div>
        <h2>ì¸ë¬¼</h2>
      </div>
      <!-- ìºë¦­í„° íƒ­ -->
      <div class="character-tabs">
        <button class="character-tab active" id="tabNpc" data-tab="npc">
          <span class="tab-icon">ğŸ‘¨â€ğŸ”§</span>ì¡´
        </button>
        <button class="character-tab" id="tabRosa" data-tab="rosa">
          <span class="tab-icon">ğŸ‘©â€ğŸ³</span>ë¡œì‚¬
        </button>
        <button class="character-tab player-tab" id="tabPlayer" data-tab="player">
          <span class="tab-icon">ğŸ¦¸</span>í”Œë ˆì´ì–´
        </button>
      </div>
      <div class="panel-content">
        <!-- === ëŒ€ì¥ì¥ì´ ì¡´ íƒ­ === -->
        <div class="character-content active" id="contentNpc">
          <!-- í˜ë¥´ì†Œë‚˜ -->
          <div class="npc-info">
            <h3>í˜ë¥´ì†Œë‚˜ (Persona)</h3>
            <div class="npc-stat">
              <span class="label">ì´ë¦„</span>
              <span class="value" id="npcName">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ë‚˜ì´</span>
              <span class="value" id="npcAge">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì§ì—…</span>
              <span class="value" id="npcOccupation">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì„±ê²©</span>
              <span class="value" id="npcTraits">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ë°°ê²½</span>
              <span class="value" id="npcBackstory" style="font-size: 0.8rem;">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ëª©í‘œ</span>
              <span class="value" id="npcGoals" style="font-size: 0.8rem;">-</span>
            </div>
          </div>

          <!-- í™˜ê²½/í˜„ì¬ìƒíƒœ (Scratch) -->
          <div class="npc-info">
            <h3>í™˜ê²½/ìƒíƒœ (Scratch)</h3>
            <div class="npc-stat">
              <span class="label">ìœ„ì¹˜</span>
              <span class="value" id="npcLocation">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">í™œë™</span>
              <span class="value" id="npcActivity">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ê¸°ë¶„</span>
              <span class="value" id="npcMood">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì‹œê°„</span>
              <span class="value" id="npcTime">-</span>
            </div>
          </div>

          <!-- ì˜¤ëŠ˜ì˜ ê³„íš (Planning) -->
          <div class="npc-info plan-section" id="planSection" style="display: none;">
            <h3>ğŸ“‹ ì˜¤ëŠ˜ì˜ ê³„íš (Planning)
              <span class="info-icon">â„¹ï¸
                <div class="info-tooltip planning-tooltip">
                  <h4>ğŸ—“ï¸ Planning ì‹œìŠ¤í…œ</h4>
                  <p>Stanford Generative Agents ë…¼ë¬¸ ê¸°ë°˜. <strong>ë§¤ì¼ ê¸°ìƒ ì‹œ LLMì´ í•˜ë£¨ ê³„íšì„ ìƒì„±</strong>í•©ë‹ˆë‹¤.</p>

                  <div class="section">
                    <div class="section-title">ğŸ“¥ ì…ë ¥ (LLMì—ê²Œ ì „ë‹¬)</div>
                    <div class="section-content">
                      <div class="input-item">1. <strong>Agent Summary</strong> - í˜ë¥´ì†Œë‚˜ + í˜„ì¬ ëª©í‘œ</div>
                      <div class="input-item">2. <strong>World Knowledge</strong> - ì•Œê³  ìˆëŠ” ì¥ì†Œ/ë„êµ¬</div>
                      <div class="input-item">3. <strong>Recent Observations</strong> - ìµœê·¼ ì¤‘ìš”í•œ ì¼ (importanceâ‰¥7)</div>
                      <div class="input-item">4. <strong>Yesterday's Activities</strong> - ì–´ì œ í™œë™ ê¸°ë¡</div>
                      <div class="input-item">5. <strong>Goal-related Memories</strong> - ëª©í‘œ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•œ ê¸°ì–µ 3ê°œ</div>
                    </div>
                  </div>

                  <div class="section">
                    <div class="section-title">ğŸ” ëª©í‘œ ê´€ë ¨ ê¸°ì–µ ê²€ìƒ‰</div>
                    <div class="section-content">
                      ëª©í‘œ ë¬¸ìì—´ì„ ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬ â†’ í‚¤ì›Œë“œ ë§¤ì¹­<br>
                      <code>score = recency + importance + relevance</code><br>
                      â€¢ recency: ìµœê·¼ ì ‘ê·¼í•œ ê¸°ì–µì¼ìˆ˜ë¡ ë†’ìŒ<br>
                      â€¢ importance: ì¤‘ìš”ë„/10 (ë¯¸í‰ê°€ ì‹œ 0.5)<br>
                      â€¢ relevance: í‚¤ì›Œë“œ ë§¤ì¹­ ë¹„ìœ¨
                    </div>
                  </div>

                  <div class="section">
                    <div class="section-title">ğŸ“¤ ì¶œë ¥</div>
                    <div class="section-content">
                      06:00~22:00 ì‹œê°„ëŒ€ë³„ í™œë™ JSON ë°°ì—´<br>
                      ê° í•­ëª©: time, activity, location, duration, goalRelated
                    </div>
                  </div>

                  <div class="section">
                    <div class="section-title">â° ì‹œê°„ ì§„í–‰</div>
                    <div class="section-content">
                      GameTimeì´ ë§¤ ì‹œê°„ ë³€ê²½ ì‹œ <code>updatePlanProgress()</code> í˜¸ì¶œ<br>
                      í˜„ì¬ ì‹œê°„ì— ë§ëŠ” ê³„íšìœ¼ë¡œ ìƒíƒœ ì „ì´<br>
                      pending â†’ in_progress â†’ completed
                    </div>
                  </div>

                  <div class="section">
                    <div class="section-title">âš ï¸ ì œí•œì‚¬í•­</div>
                    <div class="section-content">
                      â€¢ ëŒ€í™” íˆìŠ¤í† ë¦¬ëŠ” Planningì— í¬í•¨ ì•ˆ ë¨<br>
                      â€¢ ëª©í‘œ ê²€ìƒ‰ì€ ë‹¨ìˆœ í‚¤ì›Œë“œ ë§¤ì¹­ (ì˜ë¯¸ì  ìœ ì‚¬ì„± X)<br>
                      â€¢ ğŸ¯ í‘œì‹œ = ëª©í‘œ ê´€ë ¨ í™œë™
                    </div>
                  </div>
                </div>
              </span>
              <span id="planDay" style="color: #6b7280; font-weight: normal; font-size: 0.8rem;">1ì¼ì°¨</span>
            </h3>
            <div class="plan-list" id="planList">
              <!-- ê³„íš ì•„ì´í…œë“¤ì´ JSë¡œ ì¶”ê°€ë¨ -->
            </div>
          </div>

          <!-- ëŒ€í™” íˆìŠ¤í† ë¦¬ -->
          <div class="memory-section">
            <h3>ëŒ€í™” íˆìŠ¤í† ë¦¬ (History)</h3>
            <div class="memory-list" id="historyList">
              <div class="empty-state">ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>

          <!-- ë©”ëª¨ë¦¬ ìŠ¤íŠ¸ë¦¼ -->
          <div class="memory-section">
            <h3>
              ë©”ëª¨ë¦¬ ìŠ¤íŠ¸ë¦¼ (Memory) <span id="memoryCount" style="color: #6b7280; font-weight: normal;">0ê°œ</span>
              <button id="clearMemoryBtn" class="clear-btn" title="ë©”ëª¨ë¦¬ ì´ˆê¸°í™”">ì´ˆê¸°í™”</button>
            </h3>
            <div class="memory-list" id="memoryList">
              <div class="empty-state">ì•„ì§ ê¸°ì–µì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>

          <!-- ì‹œìŠ¤í…œ ë¡œê·¸ -->
          <div class="memory-section">
            <h3>ì‹œìŠ¤í…œ ë¡œê·¸ <span id="chatCounter" style="color: #6b7280; font-weight: normal; font-size: 0.8rem;">ëŒ€í™”: 0/10</span></h3>
            <div class="log-list" id="systemLog">
              <div class="log-item info">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ëŒ€ê¸°ì¤‘...</div>
            </div>
          </div>
        </div>

        <!-- === ì—¬ê´€ì£¼ì¸ ë¡œì‚¬ íƒ­ === -->
        <div class="character-content" id="contentRosa">
          <!-- í˜ë¥´ì†Œë‚˜ -->
          <div class="npc-info">
            <h3>í˜ë¥´ì†Œë‚˜ (Persona)</h3>
            <div class="npc-stat">
              <span class="label">ì´ë¦„</span>
              <span class="value" id="rosaName">ì—¬ê´€ì£¼ì¸ ë¡œì‚¬</span>
            </div>
            <div class="npc-stat">
              <span class="label">ë‚˜ì´</span>
              <span class="value" id="rosaAge">38ì„¸</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì§ì—…</span>
              <span class="value" id="rosaOccupation">ì—¬ê´€ì£¼ì¸</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì„±ê²©</span>
              <span class="value" id="rosaTraits">ì¹œì ˆí•¨, ìˆ˜ë‹¤ìŠ¤ëŸ¬ì›€, ì •ë³´í†µ, ìš”ë¦¬ì†œì”¨</span>
            </div>
            <div class="npc-stat">
              <span class="label">ë°°ê²½</span>
              <span class="value" id="rosaBackstory" style="font-size: 0.8rem;">15ë…„ ì „ ë‚¨í¸ê³¼ í•¨ê»˜ ë¶‰ì€ ë‹¬ ì—¬ê´€ì„ ì—´ì—ˆë‹¤. 5ë…„ ì „ ë‚¨í¸ì´ ë³‘ìœ¼ë¡œ ì„¸ìƒì„ ë– ë‚œ í›„ í˜¼ì ì—¬ê´€ì„ ìš´ì˜ ì¤‘.</span>
            </div>
            <div class="npc-stat">
              <span class="label">ëª©í‘œ</span>
              <span class="value" id="rosaGoals" style="font-size: 0.8rem;">ìƒˆë¡œìš´ ìš”ë¦¬ ë ˆì‹œí”¼ ê°œë°œ, ì—¬ê´€ 2ì¸µ ìˆ˜ë¦¬</span>
            </div>
          </div>

          <!-- í™˜ê²½/í˜„ì¬ìƒíƒœ (Scratch) -->
          <div class="npc-info">
            <h3>í™˜ê²½/ìƒíƒœ (Scratch)</h3>
            <div class="npc-stat">
              <span class="label">ìœ„ì¹˜</span>
              <span class="value" id="rosaLocation">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">í™œë™</span>
              <span class="value" id="rosaActivity">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ê¸°ë¶„</span>
              <span class="value" id="rosaMood">-</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì‹œê°„</span>
              <span class="value" id="rosaTime">-</span>
            </div>
          </div>

          <!-- ì˜¤ëŠ˜ì˜ ê³„íš (Planning) -->
          <div class="npc-info plan-section" id="rosaPlanSection" style="display: none;">
            <h3>ğŸ“‹ ì˜¤ëŠ˜ì˜ ê³„íš (Planning)
              <span id="rosaPlanDay" style="color: #6b7280; font-weight: normal; font-size: 0.8rem;">1ì¼ì°¨</span>
            </h3>
            <div class="plan-list" id="rosaPlanList">
              <!-- ê³„íš ì•„ì´í…œë“¤ì´ JSë¡œ ì¶”ê°€ë¨ -->
            </div>
          </div>

          <!-- ëŒ€í™” íˆìŠ¤í† ë¦¬ -->
          <div class="memory-section">
            <h3>ëŒ€í™” íˆìŠ¤í† ë¦¬ (History)</h3>
            <div class="memory-list" id="rosaHistoryList">
              <div class="empty-state">ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>

          <!-- ë©”ëª¨ë¦¬ ìŠ¤íŠ¸ë¦¼ -->
          <div class="memory-section">
            <h3>
              ë©”ëª¨ë¦¬ ìŠ¤íŠ¸ë¦¼ (Memory) <span id="rosaMemoryCount" style="color: #6b7280; font-weight: normal;">0ê°œ</span>
            </h3>
            <div class="memory-list" id="rosaMemoryList">
              <div class="empty-state">ì•„ì§ ê¸°ì–µì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>
        </div>

        <!-- === ìš©ì‚¬ ìŠ¤ë§ˆê²Œ íƒ­ === -->
        <div class="character-content" id="contentPlayer">
          <!-- í˜ë¥´ì†Œë‚˜ -->
          <div class="player-info">
            <h3>í˜ë¥´ì†Œë‚˜ (Persona)</h3>
            <div class="npc-stat">
              <span class="label">ì´ë¦„</span>
              <span class="value" id="playerName">ìš©ì‚¬ ìŠ¤ë§ˆê²Œ</span>
            </div>
            <div class="npc-stat">
              <span class="label">ë‚˜ì´</span>
              <span class="value" id="playerAge">25</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì§ì—…</span>
              <span class="value" id="playerOccupation">ëª¨í—˜ê°€</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì„±ê²©</span>
              <span class="value" id="playerTraits">ìš©ê°í•¨, í˜¸ê¸°ì‹¬, ì •ì˜ë¡œì›€</span>
            </div>
            <div class="npc-stat">
              <span class="label">ë°°ê²½</span>
              <span class="value" id="playerBackstory" style="font-size: 0.8rem;">ë¨¼ ë§ˆì„ì—ì„œ ì˜¨ ì Šì€ ëª¨í—˜ê°€. ì„¸ìƒì„ íƒí—˜í•˜ë©° ì‚¬ëŒë“¤ì„ ë•ê³ ì í•œë‹¤.</span>
            </div>
            <div class="npc-stat">
              <span class="label">ëª©í‘œ</span>
              <span class="value" id="playerGoals" style="font-size: 0.8rem;">ë§ˆì„ ì‚¬ëŒë“¤ê³¼ ì¹œí•´ì§€ê¸°, ìƒˆë¡œìš´ ì¥ë¹„ êµ¬í•˜ê¸°</span>
            </div>
          </div>

          <!-- í™˜ê²½/í˜„ì¬ìƒíƒœ (Scratch) -->
          <div class="player-info">
            <h3>í™˜ê²½/ìƒíƒœ (Scratch)</h3>
            <div class="npc-stat">
              <span class="label">ìœ„ì¹˜</span>
              <span class="value" id="playerLocation">ë§ˆì„ ì¤‘ì•™</span>
            </div>
            <div class="npc-stat">
              <span class="label">í™œë™</span>
              <span class="value" id="playerActivity">ë§ˆì„ íƒìƒ‰ ì¤‘</span>
            </div>
            <div class="npc-stat">
              <span class="label">ê¸°ë¶„</span>
              <span class="value" id="playerMood">í˜¸ê¸°ì‹¬</span>
            </div>
            <div class="npc-stat">
              <span class="label">ì†Œì§€ê¸ˆ</span>
              <span class="value" id="playerGold">100 ê³¨ë“œ</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/web/app.ts"></script>

  <!-- íŒ¨ë„ ë¦¬ì‚¬ì´ì € ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    (function() {
      const container = document.querySelector('.container');
      const leftPanel = document.getElementById('leftPanel');
      const centerPanel = document.getElementById('centerPanel');
      const rightPanel = document.getElementById('rightPanel');
      const resizer1 = document.getElementById('resizer1');
      const resizer2 = document.getElementById('resizer2');

      let isResizing = false;
      let currentResizer = null;
      let startX = 0;
      let leftWidth = 0;
      let centerWidth = 0;
      let rightWidth = 0;

      function initResizer(resizer, leftEl, rightEl) {
        resizer.addEventListener('mousedown', (e) => {
          isResizing = true;
          currentResizer = resizer;
          startX = e.clientX;

          leftWidth = leftEl.getBoundingClientRect().width;
          rightWidth = rightEl.getBoundingClientRect().width;

          resizer.classList.add('dragging');
          document.body.classList.add('resizing');

          e.preventDefault();
        });
      }

      document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;

        const dx = e.clientX - startX;
        const containerWidth = container.getBoundingClientRect().width;
        const minWidth = 200;

        if (currentResizer === resizer1) {
          const newLeftWidth = Math.max(minWidth, Math.min(leftWidth + dx, containerWidth - minWidth * 2 - 60));
          const newCenterWidth = Math.max(minWidth, leftWidth + centerPanel.getBoundingClientRect().width - newLeftWidth);

          leftPanel.style.flex = 'none';
          leftPanel.style.width = newLeftWidth + 'px';
        } else if (currentResizer === resizer2) {
          const newCenterWidth = Math.max(minWidth, Math.min(centerPanel.getBoundingClientRect().width + dx, containerWidth - minWidth * 2 - 60));
          const newRightWidth = Math.max(minWidth, rightWidth - dx);

          centerPanel.style.flex = 'none';
          centerPanel.style.width = (centerPanel.getBoundingClientRect().width + dx) + 'px';
          rightPanel.style.flex = 'none';
          rightPanel.style.width = newRightWidth + 'px';

          startX = e.clientX;
          rightWidth = newRightWidth;
        }
      });

      document.addEventListener('mouseup', () => {
        if (isResizing) {
          isResizing = false;
          if (currentResizer) {
            currentResizer.classList.remove('dragging');
          }
          document.body.classList.remove('resizing');
          currentResizer = null;
        }
      });

      initResizer(resizer1, leftPanel, centerPanel);
      initResizer(resizer2, centerPanel, rightPanel);
    })();
  </script>

  <!-- ìºë¦­í„° íƒ­ ì „í™˜ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    (function() {
      const tabs = document.querySelectorAll('.character-tab');
      const contents = document.querySelectorAll('.character-content');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const targetTab = tab.dataset.tab;

          // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
          tabs.forEach(t => t.classList.remove('active'));
          // í´ë¦­í•œ íƒ­ í™œì„±í™”
          tab.classList.add('active');

          // ëª¨ë“  ì½˜í…ì¸  ìˆ¨ê¹€
          contents.forEach(c => c.classList.remove('active'));
          // í•´ë‹¹ ì½˜í…ì¸  í‘œì‹œ
          const contentMap = {
            'npc': 'contentNpc',
            'rosa': 'contentRosa',
            'player': 'contentPlayer'
          };
          const targetContent = document.getElementById(contentMap[targetTab]);
          if (targetContent) {
            targetContent.classList.add('active');
          }
        });
      });
    })();
  </script>
</body>
</html>
